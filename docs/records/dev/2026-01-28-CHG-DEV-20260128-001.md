# 開發變更紀錄 - 2026-01-28

## 文件資訊

| 項目 | 內容 |
|------|------|
| 文件編號 | CHG-DEV-20260128-001 |
| 日期 | 2026-01-28 |
| 執行者 | Claude Code |
| 狀態 | 已完成 |

---

## 變更摘要

本日主要修復 SonarCloud 問題並改善程式碼覆蓋率。

---

## 變更詳情

### CHG-DEV-20260128-001 - Code Smells 修復

| 項目 | 內容 |
|------|------|
| 日期 | 2026-01-28 22:15 |
| 類型 | [修復] |
| commit | 818e51e |

**變更檔案 (11 個)：**
- `src/app/(auth)/login/page.tsx` - FormEventHandler 修復
- `src/app/(auth)/register/page.tsx` - FormEventHandler 修復
- `src/app/(dashboard)/layout.tsx` - readonly props
- `src/components/layout/Header/Header.tsx` - readonly props (6 個 icon)
- `src/components/layout/Sidebar/Sidebar.tsx` - readonly props (8 個 icon)
- `src/components/layout/Sidebar/SidebarContext.tsx` - readonly props
- `src/components/ui/ErrorState/ErrorState.tsx` - readonly props
- `src/components/ui/FilterBar/FilterBar.tsx` - FormEventHandler 修復
- `src/components/ui/LoadingState/LoadingState.tsx` - readonly props (4 個元件)
- `src/components/ui/Pagination/Pagination.tsx` - readonly props (4 個 icon)
- `tests/accessibility/forms.test.tsx` - readonly props

**變更說明：**
修復 SonarCloud Code Smells Phase 4：
- S6759: React props 加上 readonly 修飾符
- S1874: 使用 React.FormEventHandler 替代棄用的 FormEvent

---

### CHG-DEV-20260128-002 - Bug 修復 (typescript:S6544)

| 項目 | 內容 |
|------|------|
| 日期 | 2026-01-28 |
| 類型 | [修復] |
| commit | ec07ae8 |

**變更檔案：**
- `src/app/(auth)/register/page.tsx`

**變更說明：**
修復 SonarCloud Bug typescript:S6544 - Promise-returning function provided to attribute where void was expected。提取 async 邏輯到獨立函數 `performRegister()`，使用 `void performRegister()` 調用。

---

### CHG-DEV-20260128-003 - 新增單元測試

| 項目 | 內容 |
|------|------|
| 日期 | 2026-01-28 |
| 類型 | [新增] |
| commit | 6cfe85f |

**新增檔案：**
- `tests/unit/lib/2fa.test.ts` - 35 個測試
- `tests/unit/lib/rbac.test.ts` - 32 個測試
- `tests/unit/components/FilterBar.test.tsx` - 27 個測試

**變更說明：**
新增 94 個單元測試以提高程式碼覆蓋率，涵蓋 2FA 認證、RBAC 權限系統、FilterBar 元件。

---

### CHG-DEV-20260128-004 - 新增整合測試

| 項目 | 內容 |
|------|------|
| 日期 | 2026-01-28 |
| 類型 | [新增] |
| commit | 7fbc425 |

**新增檔案：**
- `tests/integration/api/admin/users.test.ts` - 19 個測試

**變更說明：**
新增 Admin Users API 整合測試，涵蓋 GET/POST /api/admin/users 端點的認證、權限、CRUD 操作。

---

### CHG-DEV-20260128-005 - CI/CD Workflow 修正

| 項目 | 內容 |
|------|------|
| 日期 | 2026-01-28 |
| 類型 | [修正] |
| commit | 19dd47f |

**變更檔案：**
- `.github/workflows/sonarcloud.yml`

**變更說明：**
修正 SonarCloud workflow，將 `npm run test:unit` 改為 `npm run test:coverage`，以包含整合測試的覆蓋率。預期 SonarCloud 覆蓋率從 23.7% 提升至 ~41%。

---

## 影響評估

| 項目 | 修改前 | 修改後 |
|------|--------|--------|
| SonarCloud Bugs | 2 | 0 |
| SonarCloud Code Smells | 217 | 54 |
| SonarCloud 覆蓋率 | 23.7% | ~41% (預期) |
| 測試總數 | ~100 | ~213 |

---

## 關聯資訊

- SonarCloud 專案: https://sonarcloud.io/project/overview?id=beckyeh8888_free-crm
- ISO 27001 合規: A.12.6.1 技術弱點管理

---

*此紀錄符合 ISO 27001 A.12.1.2 變更管理要求*
