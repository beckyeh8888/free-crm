# 開發變更紀錄 CHG-DEV-20260205-001

## 文件資訊

| 項目 | 內容 |
|------|------|
| 文件編號 | CHG-DEV-20260205-001 |
| 日期 | 2026-02-05 |
| 類型 | [修復] + [新增] |
| 執行者 | Claude Code |
| 狀態 | 待 commit |

## 變更摘要

Sprint 5 功能收尾 + SonarLint Code Smells 修復

## 變更檔案

### Phase 1: SonarLint 修復

| 檔案 | 變更類型 | 說明 |
|------|----------|------|
| `src/app/api/tasks/route.ts` | [修復] | 降低認知複雜度，提取 helper 函數 |
| `src/hooks/useTasks.ts` | [修復] | 降低複雜度 + 修復巢狀模板字串 |
| `src/hooks/useProjects.ts` | [修復] | 使用 type alias 取代 inline union |
| `src/components/features/gantt/GanttView.tsx` | [修復] | Case 區塊加大括號包裹 |

### Phase 2: Sprint 5 功能完成

| 檔案 | 變更類型 | 說明 |
|------|----------|------|
| `src/components/features/tasks/TaskDetailModal.tsx` | [新增] | 任務詳情 Modal 元件 |
| `src/components/features/tasks/index.ts` | [修改] | 匯出 TaskDetailModal |
| `src/components/features/calendar/CalendarPage.tsx` | [修改] | 整合 TaskDetailModal，完成 TODO |

### Phase 3: 文件同步

| 檔案 | 變更類型 | 說明 |
|------|----------|------|
| `docs/compliance/code-quality/2026-02-05-CQ-001.md` | [新增] | 程式碼品質報告 |
| `docs/records/dev/2026-02-05-CHG-DEV-001.md` | [新增] | 本檔案 |

## 修復詳情

### S3776: 認知複雜度過高

**tasks/route.ts**:
- 提取 `resolveOrganizationId` 函數
- 提取 `parseTaskFilters` 函數
- 提取 `buildTaskWhereClause` 函數
- 提取 `parseTaskOrderBy` 函數
- 提取 `validateRelatedEntities` 函數

**useTasks.ts**:
- 重構 `buildTaskQueryParams` 使用 Object.entries + filter + map

### S4624: 巢狀模板字串

**useTasks.ts:332**:
```typescript
// Before
const url = `/api/tasks/${taskId}/dependencies${queryString ? `?${queryString}` : ''}`;

// After
const suffix = queryString ? `?${queryString}` : '';
const url = `/api/tasks/${taskId}/dependencies${suffix}`;
```

### S6836: Case 區塊詞法宣告

**GanttView.tsx:37-44**:
```typescript
// Before
case 'quarter':
  const quarter = ...;

// After
case 'quarter': {
  const quarter = ...;
  break;
}
```

### S4323: Type Alias

**useProjects.ts**:
```typescript
// Before
status: 'active' | 'completed' | 'on_hold' | 'cancelled';

// After
import type { ProjectStatus } from '@/lib/validation';
status: ProjectStatus;
```

## 驗證結果

| 檢查項目 | 結果 |
|----------|------|
| TypeScript 編譯 | ✅ 通過 |
| ESLint 檢查 | ✅ 0 錯誤, 0 警告 |

## 關聯文件

- 品質報告: CQ-20260205-001
- Sprint: Sprint 5 (Calendar & Gantt Chart)

---
*此紀錄符合 ISO 27001 A.12.1.2 變更管理要求*
